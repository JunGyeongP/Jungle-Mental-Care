<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <title>JUNGLER MENTAL RESULT</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- í°íŠ¸ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <!-- graph ì‘ì„± ì‹œ í•„ìš” -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>   
    
    <style>
       body {
        width: 100%;
        height: 100%;
        min-width:700px; /* ìµœì†Œ ë„“ì´ê°€ ì§€ì›ë˜ëŠ” ë¸Œë¼ìš°ì ¸ë¥¼ ìœ„í•´ì„œ ...FF, IE7, safari */
        margin: 0px;
        padding: 0px;  /* ì˜µì…˜ì…ë‹ˆë‹¤.*/
        /* ë§Œì•½ ì½˜í…ì¸ ë¥¼ ê°€ìš´ë° ì •ë ¬ë¡œ í•˜ê³  ì‹¶ì€ ê²½ìš° text-align: center ë¥¼ íƒ€ì´í•‘ í•˜ì‹œê³ ,
           íŒ¨ë”©ê°’ì„ ì ë‹¹í•˜ê²Œ ì˜¬ë ¤ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.*/
      }
      * { 
          margin: 0;
          padding: 0;
          font-family: 'Noto Sans KR', sans-serif;
      }

      /* header */
      a { 
          text-decoration: none;
          color: inherit;
      }

      li { list-style-type: none; }

      .hbody {
          background-color: black;
          width: 100%;
          height: 100px;
      }

      .nav {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px 50px;
          color: white;
      }

      .title {
          font-size: 1.5em;
      }

      .title > a {
          color: white;
      }

      .menu-item2 a{ /* JUNGLE B í•˜ì´í¼ë§í¬ ë°‘ì¤„, ìƒ‰ê¹” ì—†ì• ê¸°*/
        text-decoration: none;
        color: inherit; 
        
      }

      #menu {
          display: flex;
          color: white;
      }
      
      #user {
        margin-left: auto;
        margin-top: 5px;
        margin: 20px;
      }

      #menu > li {
          padding: 20px 10px;
          font-size: 20px;
      }

      /* body */
      .introduce{ /* ì†Œê°œê¸€ */
        width: 860px;
        margin: 10px auto;
        padding: 10px 20px;
        padding-bottom: 0;
      }

      #card-list { 
        width: 900px;
        margin: 0 auto;
        padding: 10px 20px;
        padding-bottom: 25px;
      }

      .result-body {
        width: 860px;
        margin: 0 auto;
        padding: 30px;
        font-weight: 500;
      }
      #text{
        text-align: center;
      }

      #before-status{
        padding: 20px;
        text-align: center;
      }

  </style>

  <script>
    $(document).ready(function () {
      show_result_graph();
    });
    function logout_site() {
      $.ajax({
        type: "GET",
        url: "/api/logout",

        success: function (response) {
          if (response["result"] == "success") {
            alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!");
            window.location.href = "/login";
          } else {
            alert("ì„œë²„ ì˜¤ë¥˜!");
          }
        },
      });
    }
    function show_result_graph() {
      arr = [];
      p_date = [];
      n_date = [];

      $.ajax({
        type: "POST",
        url: "/api/post_result",
        data: { user_id: "{{session['id']}}" },

        success: function (response) {
          if (response["result"] == "success") {
            let result_list = response["result_survey"];
            for (let i = 0; i < result_list.length; i++) {
              arr.unshift(result_list[i]["date"]);
              p_date.unshift(result_list[i]["t_point"]);
              n_date.unshift(100 - result_list[i]["t_point"]);
            }

            if(arr.length==0){
                //alert("ì•„ì§ í•œë²ˆë„ ì„¤ë¬¸ì„ í•˜ì§€ ì•Šìœ¼ì…¨êµ°ìš” !")
                $(document).ready(function () {
                    //ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë‹¤ì§€ìš°ê³  ë‹¤ì‹œ ë¦¬ìŠ¤íŠ¸
                    $(".before-section").html("");
                    let card_txt = `<div class="mental-result">
                        <div class="result-body">
                          <div id="text">
                            <h3 class="card-text"><strong>ğŸï¸ì•„ì§ í•œ ë²ˆë„ ì„¤ë¬¸ì„ í•˜ì§€ ì•Šìœ¼ì…¨êµ°ìš” !ğŸ’»</strong></h3>
                          </div>
                        </div>
                      </div>

                      <div class="container" id="before-status">
                        <div class="row">
                          <div class="col">
                            <!-- ì¼ì£¼ì¼ ìƒíƒœ -->
                            <h5 class="card-text"><strong>ì •ê¸€ ìƒí™œë™ì•ˆ ê¸´ì¥ì„ í’€ê³ </strong></h5>
                            <h5 class="card-text"><strong>í”¼ì‹ ì›ƒì–´ë³´ëŠ” ìˆœê°„ì„ ìœ„í•´ ë§Œë“¤ì—ˆì–´ìš”.</strong></h5>
                            <h5 class="card-text"><strong>ê°€ë²¼ìš´ ë§ˆìŒìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì‹œê³ , ëª°ì…í•´ì„œ ì •ê¸€ì—ì„œ ì‚´ì•„ë‚¨ì•„ë³´ì•„ìš”!</strong></h5>            
                          </div>
                        </div>

                        <h1 style="padding: 210px"><a onclick="window.location.href='/mental_survey'">ğŸ‘ˆGO TO MENTAL TESTğŸ‘‰</a></h1>
                        
                      </div>`;      
                    $(".before-section").append(card_txt);
                });

            }
            else{
                drawBarHeight(arr, p_date, n_date);
                // $(document).ready(function () {
                //     //ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë‹¤ì§€ìš°ê³  ë‹¤ì‹œ ë¦¬ìŠ¤íŠ¸
                //     $(".before-section").html("");
                //     let card_txt = ``;      
                //     $(".before-section").append(card_txt);
                // });
            }           
          }
        },
      });
    }
    function drawBarHeight(arr, p_date, n_date) {
      new Chart(document.getElementById("canvas"), {
        type: "bar",
        data: {
          labels: arr,
          datasets: [
            {
              label: "ê¸ì •ì  ë‹µë³€",
              data: p_date,
              backgroundColor: "rgba(0, 128, 128, 0.5)",
            },
          ],
        },
        options: {
          title: { display: false, text: "result" },
          responsive: true,
          tooltips: {
            enabled: false,
          },
          hover: {
            mode: "nearest",
            intersect: true,
          },
          legend: {
            display: true,
          },
          scales: {
            xAxes: [
              {
                ticks: {
                  fontSize: 10,
                },
                display: true,
                stacked: false,
                barThickness: 20,
              },
            ],
            yAxes: [
              {
                ticks: {
                  min: 0,
                  max: 100,
                  fontSize: 14,
                },
                display: true,
                stacked: false,
                barThickness: 100,
              },
            ],
          },
          plugins: {
            datalabels: {
              color: "black",
              font: {
                weight: "bold",
              },
              formatter: function (value, context) {
                return Math.round(value);
              },
            },
          },
        },
      });
    }
  </script>

</head>
<body>
    <header>
        <section class="hbody">
          <article class="nav">
            <div class="title">
              <ul id="menu" style="font-weight: bold;">
                <li class="menu-item1"><a onclick="window.location.href='/mental_survey'">MENTAL TEST</a></li>
                <li class="menu-item2"><a href="https://jungle5b.herokuapp.com/" target="_blank">JUNGLE Bë°˜</a></li>
              </ul>
            </div>
            <div class="user">
              <p style="color: #FFFFFF;">ì •ê¸€ëŸ¬ {{session['id']}}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.
                <button type="submit" class="btn-sm" style="background-color: #FFFFFF;"
              onclick="logout_site()">ë¡œê·¸ì•„ì›ƒ</button></p>
            </div>
          </article>
        </section>
    </header>

    <section class="before-section">
      <div class="mental-result">
        <div class="result-body">
          <div id="text">
            <h3 class="card-text"><strong>ğŸï¸ì •ê¸€ ì† {{session['id']}}ë‹˜ì˜ ë©˜í„¸ ìƒíƒœ ê²°ê³¼ì…ë‹ˆë‹¤ !ğŸ’»</strong></h3>
          </div>
        </div>
      </div>

      <div class="container" id="before-status">
        <div class="row">
          <div class="col">
            <!-- ì¼ì£¼ì¼ ìƒíƒœ -->
            <h5 class="card-text"><strong>ğŸ•Šï¸ì¼ì£¼ì¼ê°„ì˜ ë©˜í„¸ ìƒíƒœğŸ“–</strong></h5>
            <h7>ê¸ì ì ìœ¼ë¡œ ëª°ì…í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.</h7>

            <div class="main" id="canvas_area" style="margin-top: 20px;">
              <div class="chart-container" style="margin: 0 auto; height:500px; width:500px">
                  <canvas id="canvas" height="300px"></canvas>
              </div> 
            </div>  
          </div>
        </div>
      </div>
    </section>

    <footer class="page-footer font-small cyan darken-3" style="background-color: lightgray;">
      <div class="container" style="padding: 16px; padding-bottom: 0; text-align: center; ">
        <p>ğŸŒ±You can see our githubğŸŒ´</p>
        <a href="https://github.com/midnightkang" target="_blank">ê°•ì„±ìš°</a>
        <a href="https://github.com/JunGyeongP" target="_blank">ë°•ê²½ì¤€</a>
        <a href="https://github.com/choidabom" target="_blank">ìµœë‹¤ë´„</a>
      </div>
      <div class="footer-copyright text-center py-3">&copy; Jungle week00 Team3. All Rights Reseved.</div>
    </footer>


    

</body>
<html>