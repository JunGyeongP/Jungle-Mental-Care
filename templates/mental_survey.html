<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <title>JUNGLER MENTAL</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- í°íŠ¸ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <style>
      * { 
          margin: 0;
          padding: 0;
          font-family: 'Noto Sans KR', sans-serif;
      }

      /* header */
      a { 
          text-decoration: none;
          color: inherit;
      }

      li { list-style-type: none; }

      .hbody {
          background-color: black;
          width: 100%;
          height: 100px;
      }

      .nav {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px 50px;
          color: white;
      }

      .title {
          font-size: 1.5em;
      }

      .title > a {
          color: white;
      }

      .menu-item2 a{ /* JUNGLE B í•˜ì´í¼ë§í¬ ë°‘ì¤„, ìƒ‰ê¹” ì—†ì• ê¸°*/
        text-decoration: none;
        color: inherit; 
      }

      #menu {
          display: flex;
          color: white;
      }
      
      #user {
        margin-left: auto;
        margin-top: 5px;
        margin: 20px;
      }

      #menu > li {
          padding: 20px 10px;
          font-size: 20px;
      }

      /* body */
      .introduce{ /* ì†Œê°œê¸€ */
        width: 860px;
        margin: 10px auto;
        padding: 10px 20px;
        padding-bottom: 0;
      }

      #card-list { 
        width: 900px;
        margin: 0 auto;
        padding: 20px;
        padding-top: 0;
        padding-bottom: 25px;
      }

      .introduce-body{
        width: 860px;
        margin: 10px auto;
        padding: 30px;
        padding-bottom: 0;
        font-weight: 500;
        text-align: center;
      }

      #survey_submit {
        width: 860px;
        margin: 0 auto;
      }

      .answer {
        margin: auto;
      }
      
      #card-text {
        text-align: center;
      }
    
  </style>

  <script>
    var card_count=0 , total=0, n_total=0, p_total = 0;
      $(document).ready(function () {
        //ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë‹¤ì§€ìš°ê³  ë‹¤ì‹œ ë¦¬ìŠ¤íŠ¸
        //  $("#card-list").html("");
        listCard();
      });

      function listCard() {
        $.ajax({
          type: "GET",
          url: "/api/get",
          data: {},
          success: function (response) {
            if (response["result"] == "success") {
              let cards = response["cards"];
            
              for (let i = 0; i < cards.length; i++) {
                makeCard(cards[i]["text"],i+1,cards[i]["np"]);
              }
              card_count = cards.length
            }
          },
        });
      }

      
      function makeCard(text,number, status) {
        if(status=='p'){
          let card_txt = `<br>
                        <div class="card" id="card-${number}">
                          <div class="card-body" style="margin: 10px;">
                            <div id="text">
                              <h6 class="card-title" >Question ${number}</h6>
                              <h4 class="card-text" style="font-weight: 600;">${text}</h4>
                            </div>
                            <br>
                            <div id="check" style="text-align: center;">
                              <label class="btn btn-sm">
                                <input type="radio" name="p${number}" id="jb-radio-1" value="1" onclick="colorChange(${number})"> ì•„ë‹ˆ ë¬´ìŠ¨ ë§ë„ ì•ˆ ë˜ëŠ” ì†Œë¦¬!
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="p${number}" id="jb-radio-1" value="2" onclick="colorChange(${number})"> ê·¸ë ‡ì§„ ì•Šë‹¤.
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="p${number}" id="jb-radio-1" value="3" onclick="colorChange(${number})"> Not Bad, Not Good
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="p${number}" id="jb-radio-1" value="4" onclick="colorChange(${number})"> ë§ì•„.. ê·¸ë ‡ë‹¤.
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="p${number}" id="jb-radio-1" value="5" onclick="colorChange(${number})"> ì§„ì§œ ë„ˆë¬´ ë§¤ìš° ê·¸ë ‡ë‹¤.
                              </label>
                              
                            </div>
                          </div>
                        </div>`;      
        $("#card-list").append(card_txt);
      } else {
          let card_txt = `<br>
                        <div class="card" id="card-${number}">
                          <div class="card-body" style="margin: 10px;">
                            <div id="text">
                              <h6 class="card-title" >Question ${number}</h6>
                              <h4 class="card-text" style="font-weight: 600;">${text}</h4>
                            </div>
                            <br>
                            <div id="check" style="text-align: center;">
                              <label class="btn btn-sm">
                                <input type="radio" name="n${number}" id="jb-radio-1" value="5" onclick="colorChange(${number})"> ì•„ë‹ˆ ë¬´ìŠ¨ ë§ë„ ì•ˆ ë˜ëŠ” ì†Œë¦¬!
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="n${number}" id="jb-radio-1" value="4" onclick="colorChange(${number})"> ê·¸ë ‡ì§„ ì•Šë‹¤.
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="n${number}" id="jb-radio-1" value="3" onclick="colorChange(${number})"> Not Bad, Not Good
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="n${number}" id="jb-radio-1" value="2" onclick="colorChange(${number})"> ë§ì•„.. ê·¸ë ‡ë‹¤.
                              </label>
                              <label class="btn btn-sm">
                                <input type="radio" name="n${number}" id="jb-radio-1" value="1" onclick="colorChange(${number})"> ì§„ì§œ ë„ˆë¬´ ë§¤ìš° ê·¸ë ‡ë‹¤.
                              </label>
                              
                            </div>
                          </div>
                        </div>`;
      $("#card-list").append(card_txt);
        }
      }

      function colorChange(i) {
        $('#card-'+i.toString()).css('background-color', '#daecde');
        
      }
      
      function survey_commit() { //ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜(ië¥¼ ë°›ì•„ì˜¤ëŠ” ì´ìœ  : ì¹´ë“œë¥¼ ë§Œë“¤ ë•Œ ì¹´ë“œë§ˆë‹¤ ë³„ë„ì˜ idê°’ì„ ë§Œë“¤ì–´ iê°’ì„ í†µí•´ ê°ê°ì˜ ì¹´ë“œì˜ inputê³¼ textareaì˜ ê°’ì„ ë°›ì•„ì˜¤ê¸° ìœ„í•¨)
    var check_p=0,check_n=0;
    var p_total =0, n_total=0, total=0;
    for (let i = 1; i <=card_count; i++) {
         var p_truefalse=$('input[name=p'+i+']').is(":checked");
         if(p_truefalse==true){
           check_p=check_p+1;
           p_total=p_total+Number($('input[name=p'+i+']:checked').val());
         }
       }

       for (let i = 1; i <=card_count; i++) { 
         var n_truefalse=$('input[name=n'+i+']').is(":checked");
         if(n_truefalse==true){
           check_n=check_n+1;
           n_total=n_total+Number($('input[name=n'+i+']:checked').val());
         }
       }
       
       total= p_total+n_total;

       var check = check_p+check_n;

          if(check != card_count){
            alert("ì„ íƒí•˜ì§€ ì•Šì€ í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤!")
          }
          else{ 
            
            $.ajax({
                type: "POST",
                url: "/api/survey_commit",
                data: {user_id: "{{session['id']}}", t_point: total, n_point: n_total, p_point:p_total},
                success: function (response) {
                    if (response['result'] == 'success') {
                        alert("ì €ì¥ì™„ë£Œ")
                        window.location.href='/mental_result'
                    }
                    else
                    {
                        alert("ì„œë²„ ì˜¤ë¥˜");
                    }
                }
            });
          }
        }
      function logout_site() {
        $.ajax({
          type: "GET",
          url: "/api/logout",
                    
          success: function (response) {
            if (response['result'] == 'success') {
              alert('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!');
              window.location.href='/login'
            }
            else {
              alert("ì„œë²„ ì˜¤ë¥˜!");
            }
          }
        });
      }

  </script>

</head>
<body>
    <header>
        <section class="hbody">
          <article class="nav">
            <div class="title">
              <ul id="menu">
                <li class="menu-item1"><a onclick="window.location.href='/mental_survey'">MENTAL TEST</a></li>
                <li class="menu-item2"><a href="https://jungle5b.herokuapp.com/" target="_blank">JUNGLE B</a></li>
              </ul>
            </div>
            <div class="user">
              <p style="color: #FFFFFF;">ì •ê¸€ëŸ¬ {{session['id']}}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.
                <button type="submit" class="btn-sm" style="background-color: #FFFFFF;"
              onclick="logout_site()">ë¡œê·¸ì•„ì›ƒ</button></p>
            </div>
          </article>
          
        </section>
    </header>

    <section>
          <div class="question-list">
            <!-- ì†Œê°œê¸€ -->
            <div class="introduce-body">
              <div id="text">
                <h3 class="card-text"><strong>ğŸï¸ì •ê¸€ ì† ë‹¹ì‹ ì˜ ë©˜íƒˆ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì„¸ìš” !ğŸ’»</strong></h3>
                <br>
                <h6 class="card-text">ì •ê¸€ ì†ì—ì„œ ë§¤ìˆœê°„, ë§¤ì¼ì„ ëª°ì…í•´ì„œ ë³´ë‚´ê³  ê³„ì‹  ë‹¹ì‹ ì˜ ë©˜íƒˆ ìƒíƒœë¥¼ ì ê²€í•´ë³´ì•„ìš”.</h6>
                <h6 class="card-text">ê·¸ë¦¬ ë¬´ê²ì§€ë„ ê°€ë³ì§€ë„ ì•Šì€ ì§ˆë¬¸ë“¤ë¡œ í•˜ë£¨ë¥¼ ë˜ëŒì•„ë³´ê³  ê²°ê³¼ë¥¼ ì‚´í´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</h6>
                <br>
                <!-- ë©˜íƒˆ ì„¤ë¬¸ ì œì¶œ -->
                <button style="width: 300px;" class="btn btn-outline-success btn" type="submit" onclick="window.location.href='/mental_result'">ì´ì „ ì„¤ë¬¸ì¡°ì‚¬ ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
              </div>
            </div>

            <!-- ë©˜íƒˆ ì„¤ë¬¸ -->
            <div id="card-list">
              
            </div>
            
            <!-- ë©˜íƒˆ ì„¤ë¬¸ ì œì¶œ -->
            <div class="mb-3" id="survey_submit">
            <button style="width: 860px;" class="btn btn-outline-success btn" type="submit" onclick="survey_commit()" >ì™„ë£Œ</button>
            </div>
          </div>
        </p>
    </section>

    <footer class="page-footer font-small cyan darken-3" style="background-color: lightgray;">
      <div class="container" style="padding: 16px; padding-bottom: 0; text-align: center; ">
        <p>ğŸŒ±You can see our githubğŸŒ´</p>
        <a href="https://github.com/midnightkang" target="_blank">ê°•ì„±ìš°</a>
        <a href="https://github.com/JunGyeongP" target="_blank">ë°•ê²½ì¤€</a>
        <a href="https://github.com/choidabom" target="_blank">ìµœë‹¤ë´„</a>
      </div>
      <div class="footer-copyright text-center py-3">&copy; Jungle week00 Team3. All Rights Reseved.</div>
    </footer>
</body>
<html>